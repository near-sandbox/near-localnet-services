---
alwaysApply: true
description: NEAR Localnet Services (Layer 2) - essential utility services for localnet development
---

# NEAR Localnet Services Guide

**Layer 2: Essential utility services for NEAR localnet development**

## Layer Architecture Position

**This is Layer 2 of the 5-layer NEAR Localnet Simulator Stack:**

```
Layer 1: NEAR Base          → AWSNodeRunner
Layer 2: NEAR Services      → This repository ← YOU ARE HERE
Layer 3: Chain Signatures   → cross-chain-simulator (includes MPC)
Layer 4: Intents Protocol   → near-intents-simulator
Layer 5: User Applications  → Your dApp
```

**Depends on**: Layer 1 (NEAR Base) - requires RPC endpoint
**Provides to**: All higher layers - utilities like faucet, gas payer

**Architecture Reference**: See `/CORRECTED_ARCHITECTURE.md` for complete stack details.

## Project Overview

This repository provides essential utility services for NEAR localnet development:
- **Faucet**: Token distribution for test accounts
- **Gas Payer** (future): Pay gas fees for users
- **Account Management** (future): Helper utilities
- **Monitoring** (future): Health checks

## Current Services

### Faucet Service

Lambda-based faucet for distributing test tokens on localnet.

**Location**: `faucet/`
**Deployment**: AWS CDK (`faucet/cdk`)
**Handler**: Lambda function with SSM key management

**Features**:
- Single account transfers
- Batch transfers to multiple accounts
- AWS Lambda deployment
- Secure key management via SSM

## Deployment

### Via Orchestrator
```bash
cd /near-localnet-orchestrator
npx near-orchestrator deploy near_base near_services
```

### Standalone Deployment
```bash
cd faucet/cdk
npm install
npm run deploy
```

## Configuration

The faucet requires NEAR RPC URL from Layer 1:

```yaml
# In orchestrator config
near_services:
  depends_on: ["near_base"]
  config:
    deploy_faucet: true
    master_account_id: "node0"
    rpc_url: "${near_base.outputs.rpc_url}"
```

## Integration with Other Layers

### Layer 1 (NEAR Base) Provides:
- NEAR RPC endpoint
- VPC ID (for Lambda connectivity)
- Network ID

### Layer 3 (Chain Signatures) Uses:
- Faucet endpoint for account funding
- RPC URL (inherited from Layer 1)

### Layer 4 (Intents Protocol) Uses:
- Faucet for test account setup
- Account utilities

## AWS Profile

All AWS commands use: `--profile shai-sandbox-profile`

## Repository Structure

```
near-localnet-services/
├── faucet/
│   ├── cdk/                     # CDK deployment
│   │   ├── lib/                 # Stack definitions
│   │   └── config.local.json    # Generated config
│   ├── src/                     # Lambda handler
│   └── README.md                # Faucet documentation
├── README.md                    # "Layer 2: NEAR Services"
└── (future services...)
```

## Important Notes

1. **Layer 2 is Required**: Not optional - simplifies architecture
2. **Depends on Layer 1**: Must deploy NEAR Base first
3. **Provides Utilities**: Used by Layers 3, 4, and 5
4. **Lambda-based**: Serverless deployment for low cost
5. **VPC-aware**: Connects to NEAR node in VPC

## Cost

~$5-10/month for Lambda invocations

## Development

```bash
# Build
npm run build

# Deploy faucet
cd faucet/cdk
npm run deploy

# Destroy
npm run destroy
```
